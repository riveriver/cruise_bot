<launch>
  <arg name="rviz" default="true" />
  <param name="/use_sim_time" value="true"/>
  <arg name="nav_map_path" value="$(find cruise_resource)/maps/simple_room.yaml"/>
  <arg name="cmd_vel_topic" default="/cmd_vel" />
  <arg name="odom_topic" default="odom" />
  <!-- <arg name="odom_topic" default="Odometry" /> -->

  <include file="$(find cruise_simu)/launch/simple_world.launch"></include>

	<node name = "map_server" pkg = "map_server" type = "map_server" args="$(arg nav_map_path) map:=nav_map">
		<param name="frame_id" value="map" />
	</node>

  <!-- move_base_flex -->
  <node pkg="mbf_costmap_nav" type="mbf_costmap_nav" respawn="false" name="move_base_flex" output="screen" args="/map:=nav_map /odom:=$(arg odom_topic)">
      <rosparam file="$(find cruise_nav)/param/sim_costmap_params.yaml" command="load" />
      <rosparam file="$(find cruise_nav)/param/move_base_flex_params.yaml" command="load" />
      <rosparam file="$(find cruise_nav)/param/recovery_behavior_params.yaml" command="load" />
      <rosparam file="$(find cruise_nav)/param/teb_local_planner_params.yaml" command="load" />
      <rosparam file="$(find cruise_nav)/param/costmap_converter_params.yaml" command="load" />
      <remap from="cmd_vel" to="$(arg cmd_vel_topic)"/>
  </node>
  <node pkg="cruise_nav" type="mbf_bridge" respawn="false" name="mbf_bridge" output="screen"/>

  <node pkg="tf2_ros" type="static_transform_publisher" name="tf_map__to_odom" args="0 0 0 0 0 0 map odom"/>

	<group if="$(arg rviz)">
	<node launch-prefix="nice" pkg="rviz" type="rviz" name="rviz" args="-d $(find cruise_nav)/rviz/nav.rviz" />
	</group>

</launch>
